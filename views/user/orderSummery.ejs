<link
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
  rel="stylesheet"
  integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
  crossorigin="anonymous"
/>

<style>
  .order_d_inner .details_item h4 {
    border-bottom: 1px solid #eee;
    padding-bottom: 12px;
    font-size: 18px;
    color: #222222;
    padding-left: 18px;
  }
  .order_d_inner .details_item .list {
    padding-left: 18px;
  }
  @media (min-width: 767px) {
    .order_d_inner .details_item .list {
      margin-bottom: 30px;
    }
  }
  .order_d_inner .details_item .list li {
    margin-bottom: 8px;
  }
  .order_d_inner .details_item .list li:last-child {
    margin-bottom: 0px;
  }
  .order_d_inner .details_item .list li a {
    font-size: 14px;
    color: #222222;
    font-family: "Roboto", sans-serif;
  }
  .order_d_inner .details_item .list li a span {
    width: 145px;
    display: inline-block;
    color: #777777;
  }
  ul {
    list-style: none;
  }

  .order_details .title_confirmation {
    text-align: center;
    color: #28d500;
    font-size: 18px;
    margin-bottom: 80px;
  }

  .order_details_table {
    background: #e5ecee;
    padding: 30px;
    margin-top: 75px;
  }
  @media (min-width: 767px) {
    .order_details_table {
      margin-top: 45px;
    }
  }
  .order_details_table h2 {
    color: #222222;
    font-size: 18px;
    padding-bottom: 15px;
  }
  .order_details_table .table {
    margin-bottom: 0px;
  }
  .order_details_table .table thead tr th {
    border-bottom: 1px solid #ddd;
    font-size: 14px;
    font-family: "Roboto", sans-serif;
    font-weight: normal;
  }
  .order_details_table .table tbody tr td p {
    margin-bottom: 0px;
  }
  .order_details_table .table tbody tr td h5 {
    color: #222222;
    margin-bottom: 0px;
  }
  .order_details_table .table tbody tr td h4 {
    font-size: 14px;
    text-transform: uppercase;
    margin-bottom: 0px;
    color: #222222;
  }
  .order_details_table .table tbody tr:last-child td {
    border-top: 1px solid #ddd;
  }
  .order_details_table .table tbody tr:last-child td p {
    color: #222222;
  }
</style>
<%-include('../user/layout/user-header-layout')-%>

<!-- End Banner Area -->

<!--================Order Details Area =================-->
<section class="order_details section_gap">
  <div class="container mt-5">
    <% if (id.orderStatus=="cancelled") { %>
    <h3 class="title_confirmation text-danger">
      Your order has been Cancelled.
    </h3>
    <% } else if(id.orderStatus == 'Delivered'){%>

    <h3 class="title_confirmation">
      Thank you. Your order has been Delivered.
    </h3>
    <% }else{ %>
    <h3 class="title_confirmation" style="margin-top:100px;">Thank you. Your order has been recived.</h3>
    <% } %>

    <div class="row order_d_inner">
      <div class="col-lg-4">
        <div class="details_item">
          <h4>Order Info</h4>
          <ul class="list">
            <li>
              <a href="#"><span>Order number</span> : 60235</a>
            </li>
            <li>
              <a href="#"
                ><span>Date</span> : <%= id.createdAt.toLocaleDateString() %></a
              >
            </li>
            <li>
              <a href="#"><span>Total</span> : Rs<%= id.totalAmount %></a>
            </li>
            <li>
              <a href="#"
                ><span>Payment method</span> : <%= id.paymentMethod %></a
              >
            </li>
          </ul>
        </div>
      </div>
      <div class="col-lg-4">
        <div class="details_item">
          <h4>Billing Address</h4>
          <ul class="list">
            <li>
              <a href="#"
                ><span>Street</span> : <%= id.Address[0].city %></a
              >
            </li>
            <li>
              <a href="#"><span>City</span> :  <%= id.Address[0].city %></a>
            </li>
            <li>
              <a href="#"
                ><span>state</span> :  <%= id.Address[0].state %></a
              >
            </li>
            <li>
              <a href="#"
                ><span>Postcode </span> : <%= id.Address[0].pincode %></a
              >
            </li>
          </ul>
        </div>
      </div>
      <div class="col-lg-4">
        <div class="details_item">
          <h4>Shipping Address</h4>
          <ul class="list">
            <li>
              <a href="#"
                ><span>State</span> : <%= id.Address[0].state %></a
              >
            </li>
            <li>
              <a href="#"><span>City</span> : <%= id.Address[0].city %></a>
            </li>
            <li>
              <a href="#"
                ><span>Country</span> : India</a
              >
            </li>
            <li>
              <a href="#"
                ><span>Postcode </span> : <%= id.Address[0].pincode %></a
              >
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="order_details_table">
      <h2>Order Details</h2>
      <div class="table-responsive">
        <table class="table">
          <thead>
            <tr>
              <th scope="col">Product</th>
              <th scope="col"></th>
              <th scope="col">Total</th>
            </tr>
          </thead>
          <tbody>
           

            <tr>
              <td>
                <p><%= id.vehicles[0].bikeName %></p>
              </td>
              
              <td>
               
              </td>
            </tr>
            
            <tr>
              <td>
                <h4></h4>
              </td>
              <td>
                <h5></h5>
              </td>
              <td>
                <p>Rs<%= id.totalAmount %></p>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <div class="container text-center mt-5">
      <% if(id.orderStatus != 'Cancelled' && id.orderStatus != 'Delivered'){ %>

      <button
        onclick="cancelOrder('<%=id._id%>')"
        type="button"
        class="btn btn-danger"
      >
        Cancel
      </button>
      <% } %>
      <a class="btn btn-outline-primary" href="/">Go back to Shopping</a>

      <% if ( id.orderStatus == 'Delivered') { %>

      <button
        type="button"
        class="btn btn-outline-primary"
        data-bs-toggle="modal"
        data-bs-target="#exampleModal"
      >
        Return Order
      </button>
      <% } %>
      <!-- Button trigger modal -->

      <!-- Modal -->
      <div
        class="modal fade"
        id="exampleModal"
        tabindex="-1"
        aria-labelledby="exampleModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h1 class="modal-title fs-5" id="exampleModalLabel">
                Return Order #<%= id._id %>
              </h1>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <p>Why are you retturning this order ?</p>
            <div class="modal-body">
              <select
                style="background-color: yellow; text-size-adjust: 12px"
                data-oid="<%= id._id %> "
                name="track"
                id="track"
              >
                <option value="Delivery is later than expected">
                  Delivery is later than expected
                </option>

                <option value="Purchased by mistake ">
                  Purchased by mistake
                </option>
                <option value="Item no longer needed">
                  Item no longer needed
                </option>
                <option value="Other reasons">Other reasons</option>
              </select>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Close
              </button>
              <button
                type="button"
                class="btn btn-primary"
                onclick="orderStatus(this)"
              >
                Return
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<!--================End Order Details Area =================-->

<%-include('../user/layout/user-footer-layout')-%>	

<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
  function cancelOrder(orderId) {
    Swal.fire({
      title: "Are you sure?",
      text: "You won't be able to revert this!",
      icon: "warning",
      showCancelButton: true,
      confirmButtonColor: "#3085d6",
      cancelButtonColor: "#d33",
      confirmButtonText: "Yes, Cancel Order!",
      cancelButtonText: "No",
    }).then((result) => {
      if (result.isConfirmed) {
        $.ajax({
          url: "/cancelOrder/?id=" + orderId,
          method: "get",
        });
        Swal.fire(
          "Cancelled!",
          "Your orderd has been Cancelled.",
          "success"
        ).then(() => {
          window.location = "/viewOrders";
        });
      }
    });
  }
</script>

<script>
  function orderStatus(e) {
    const oid = $("#track").data("oid");
    const value = $("#track").find(":selected").val();
    alert(`oid = ${oid}`);
    alert(`value = ${value}`);

    $.ajax({
      url: "/returnOrder",
      data: {
        oid,
        value,
      },
      method: "post",
      success: (response) => {
        if (response.status) {
          Swal.fire({
            position: "top-end",
            icon: "success",
            title: "Track status has been changed",
            showConfirmButton: false,
            timer: 1000,
          });
        }
      },
    });
  }
</script>
<!-- JavaScript Bundle with Popper -->
<script
  src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
  crossorigin="anonymous"
></script>